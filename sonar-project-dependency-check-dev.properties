# ./gradlew clean test jacocoTestReport assemble dependencyCheckAggregate
# sonar-scanner -Dproject.settings=sonar-project-dependency-check-dev.properties

sonar.projectKey=keycloak-plugin-dependency-check
sonar.host.url=http://localhost:9000
sonar.login=${env.SONAR_LOGIN_DEPENDENCY_CHECK}
sonar.dependencyCheck.jsonReportPath=build/reports/dependency-check-report.json
sonar.dependencyCheck.htmlReportPath=build/reports/dependency-check-report.html

# Include coverage reports for the dependency check project
sonar.coverage.jacoco.xmlReportPaths=build/jacoco/test.xml,p1-keycloak-plugin/build/jacoco/test.xml,quarkus-ext-routing/deployment/build/jacoco/test.xml,quarkus-ext-routing/runtime/build/jacoco/test.xml

# Exclude test files from code quality analysis (only use them for coverage)
sonar.exclusions=**/src/test/**/*,**/theme/**/*.js,**/theme/**/*.css
sonar.test.inclusions=**/src/test/**/*

# Exclude theme files from coverage requirements (matching main project)
sonar.coverage.exclusions=**/src/main/resources/theme/**,**/theme/**,**/resources/theme/**


## modules
sonar.modules=module1,module2,module3

module1.sonar.projectKey=p1-keycloak-plugin
module1.sonar.projectBaseDir=p1-keycloak-plugin
module1.sonar.sources=src/main
module1.sonar.java.binaries=build/classes/java/main
module1.sonar.coverage.jacoco.xmlReportPaths=build/jacoco/test.xml
module1.sonar.dependencyCheck.jsonReportPath=build/reports/dependency-check-report.json
module1.sonar.dependencyCheck.htmlReportPath=build/reports/dependency-check-report.html

module2.sonar.projectKey=quarkus-ext-routing-deployment
module2.sonar.projectBaseDir=quarkus-ext-routing/deployment
module2.sonar.sources=src/main
module2.sonar.java.binaries=build/classes/java/main
module2.sonar.coverage.jacoco.xmlReportPaths=build/jacoco/test.xml
module2.sonar.dependencyCheck.jsonReportPath=build/reports/dependency-check-report.json
module2.sonar.dependencyCheck.htmlReportPath=build/reports/dependency-check-report.html

module3.sonar.projectKey=quarkus-ext-routing-runtime
module3.sonar.projectBaseDir=quarkus-ext-routing/runtime
module3.sonar.sources=src/main
module3.sonar.java.binaries=build/classes/java/main
module3.sonar.coverage.jacoco.xmlReportPaths=build/jacoco/test.xml
module3.sonar.dependencyCheck.jsonReportPath=build/reports/dependency-check-report.json
module3.sonar.dependencyCheck.htmlReportPath=build/reports/dependency-check-report.html

# ---- SonarQube Rule Exceptions ----
# Ignore both categories of Nashorn-incompatible rules in mm_username.js
sonar.issue.ignore.multicriteria=e1,e2

# Suppress "Unexpected var, use let or const instead"
sonar.issue.ignore.multicriteria.e1.ruleKey=javascript:S3504
sonar.issue.ignore.multicriteria.e1.resourceKey=p1-keycloak-plugin/src/main/resources/mm_username.js

# Suppress "Prefer using an optional chain expression"
sonar.issue.ignore.multicriteria.e2.ruleKey=javascript:S6582
sonar.issue.ignore.multicriteria.e2.resourceKey=p1-keycloak-plugin/src/main/resources/mm_username.js
